"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _glob = require("glob");

var _index = require("../../index");

var path = require('path');

class Svg2JsonPlugin {
  constructor(sourceFolder, targetJsonFilename, appConfig) {
    this.sourceFolder = void 0;
    this.targetJsonFlename = void 0;
    this.plugin = {};
    this.appConfig = void 0;
    this.sourceFolder = sourceFolder;
    this.targetJsonFlename = targetJsonFilename;
    this.appConfig = appConfig;
    this.plugin = {
      name: 'Svg2JsonPlugin'
    };
  }

  apply(compiler) {
    var _this = this;

    var beforeCompile = function (compilation, callback) {
      var filename = _this.targetJsonFlename;
      var sourceFolder = _this.sourceFolder,
          appConfig = _this.appConfig;
      var svgs = [];
      var searchFiles = `${appConfig.absPatternPath}/**/${sourceFolder}/*.svg`;

      var files = _glob.glob.sync(searchFiles);

      files.forEach(function (file) {
        svgs.push(path.basename(file, '.svg'));
      });
      var data = {
        svgs: svgs
      };
      (0, _index.syncSilo)(filename, data);
      callback(null);
    };

    if (compiler.hooks) {
      compiler.hooks.beforeCompile.tapAsync(this.plugin, beforeCompile);
    } else {
      compiler.plugin('beforeCompile', beforeCompile);
    }
  }

}

exports.default = Svg2JsonPlugin;